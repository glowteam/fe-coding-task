"use strict";angular.module("flightDataApp",["ngRoute","ngMaterial","papaParse","uiGmapgoogle-maps","googlechart"]),angular.module("flightDataApp").config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyBGGmRiqyJ10ddbL-pqToVR16LHWco7g1Y",v:"3.26",libraries:"weather,geometry,visualization"})}]),angular.module("flightDataApp").config(["$mdIconProvider",function(a){a.icon("action:flight_land","images/icons/ic_flight_land_24px.dcababd8.svg").icon("action:watch_later","images/icons/ic_watch_later_24px.9217441c.svg").icon("navigation:menu","images/icons/ic_menu_24px.204f61a1.svg").icon("map:place","images/icons/ic_place_24px.49827d19.svg")}]),angular.module("flightDataApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}]),angular.module("flightDataApp").controller("MainCtrl",["flightDataService",function(a){function b(a){var b=a?i.airports.filter(c(a)):i.airports;return b}function c(a){var b=angular.lowercase(a);return function(a){return 0===angular.lowercase(a.iata).indexOf(b)}}function d(a){"undefined"!=typeof a&&(e(a),g(a))}function e(b){var c=a.getFlightsTo(b.iata),d=[],e=[];for(var f in c){i.flightsTo.push(c[f]);var g=i.airports.find(function(a){return a.iata===f});e.push({id:g.iata,coords:{latitude:g.lat,longitude:g.lon},options:{label:g.iata},distance:c[f].distance,show:!0}),d.push({stroke:{color:"#303f9f",weight:1,opacity:.8},path:[{latitude:b.lat,longitude:b.lon},{latitude:g.lat,longitude:g.lon}]})}i.map={destination:{coords:{latitude:b.lat,longitude:b.lon},options:{label:b.iata}},zoom:4,options:{scrollwheel:!1},center:{latitude:b.lat,longitude:b.lon},origins:e,polylines:d}}function f(a,b,c){c.show=!c.show}function g(b){var c=a.getFlightFrequency(b.iata),d=[];for(var e in c){i.totalLand+=c[e].count;var f=c[e].count,g=0;"undefined"!=typeof c[e].delay&&(i.totalDelayed+=c[e].delay.count,f-=c[e].delay.count,g=c[e].delay.time/c[e].delay.count);var h=[{v:parseInt(e),f:"Flights at "+parseInt(e)+" - "+(parseInt(e)+1)},{v:f,f:f+(f>1?" times":" time")}];"undefined"!=typeof c[e].delay&&h.push({v:c[e].delay.count,f:c[e].delay.count+(c[e].delay.count>1?" times":" time")+"\nAverage: "+g.toPrecision(2)+(g>1?" hours ":" hour ")+"delayed"}),h.push(null),d.push({c:h})}d.sort(function(a,b){return a.c[0].v-b.c[0].v}),i.chart.data.rows=d}function h(){a.loadAll().then(function(){i.airports=a.getAirports(),i.isFlightDataLoaded=!0})["catch"](function(a){console.log(a)})}var i=this;i.isFlightDataLoaded=!1,i.airports=[],i.querySearch=b,i.selectedItemChange=d,i.flightsTo=[],i.totalLand=0,i.totalDelayed=0,i.onClick=f,i.init=h,i.init(),i.chart={type:"ColumnChart",displayed:!1,data:{cols:[{id:"hour",label:"Hour",type:"number",p:{}},{id:"ontime",label:"On time",type:"number",p:{}},{id:"delayed",label:"Delayed",type:"number",p:{}}]},options:{isStacked:"true",fill:20,displayExactValues:!0,vAxis:{title:"Frequency",gridlines:{count:10}},hAxis:{title:"Hour",gridlines:{count:5}},tooltip:{isHtml:!1}},formatters:{},view:{}}}]),angular.module("flightDataApp").factory("flightDataService",["$http","$q","papa",function(a,b,c){function d(){var a=b.defer();return e().then(function(b){f().then(function(c){g(c,b),a.resolve()})["catch"](function(b){a.reject(b)})})["catch"](function(b){a.reject(b)}),a.promise}function e(){var c=b.defer();return a({method:"GET",url:l}).then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise}function f(){var c=b.defer();return a({method:"GET",url:k}).then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise}function g(a,b){m.flights=c.parse(a,{header:!0}).data;var d=m.flights.map(function(a){return a.destination}),e=new Set(d);return e.forEach(function(a){var c=b.find(function(b){return b.iata===a});"undefined"!=typeof c&&m.airports.push(c)}),m.flights.forEach(function(a){var b=a.origin,c=a.destination;"undefined"==typeof m.routes[c]&&(m.routes[c]=[]),"undefined"==typeof m.routes[c][b]&&(m.routes[c][b]={origin:b,date:a.date,delay:a.delay,distance:a.distance})}),m.flights}function h(){return m.airports}function i(a){return m.routes[a]}function j(a){var b=m.flights.filter(function(b){return b.destination===a}),c=[];return b.forEach(function(a){var b=a.date.substring(4,6);"undefined"==typeof c[b]?c[b]={count:1}:c[b].count++;var d=parseInt(a.delay);d>0&&("undefined"==typeof c[b].delay?c[b].delay={count:1,time:d}:(c[b].delay.count++,c[b].delay.time+=d))}),c}var k="https://s3-ap-southeast-2.amazonaws.com/glow-dev-assets/flight-data-gz.csv",l="/assets/airports.json",m=this;return m.flights=[],m.airports=[],m.routes=[],m.loadAll=d,m.getAirports=h,m.getFlightsTo=i,m.getFlightFrequency=j,m}]),angular.module("flightDataApp").directive("scrollShadow",function(){return{restrict:"A",link:function(a,b,c){var d=angular.element(document.querySelector("#"+c.scrollShadow));d.bind("scroll",function(){d[0].scrollTop>15?b.addClass("md-whiteframe-z2"):b.removeClass("md-whiteframe-z2")})}}}),angular.module("papaParse",[]).factory("papa",["$window",function(a){if(a.Papa){a._thirdParty=a._thirdParty||{},a._thirdParty.Papa=a.Papa;try{delete a.Papa}catch(b){a.Papa=void 0}}var c=a._thirdParty.Papa;return c}]),angular.module("flightDataApp").run(["$templateCache",function(a){a.put("views/main.html",'<md-progress-linear class="md-accent" ng-hide="ctrl.isFlightDataLoaded" mode="indeterminate"></md-progress-linear> <div class="md-padding" layout="row" layout-align="center center"> <md-autocomplete ng-show="ctrl.isFlightDataLoaded" md-selected-item="ctrl.selectedItem" md-selected-item-change="ctrl.selectedItemChange(item)" md-search-text="ctrl.searchText" md-items="item in ctrl.querySearch(ctrl.searchText) | orderBy:\'iata\'" md-item-text="item.name" md-min-length="0" placeholder="Choose a destination" flex="70"> <md-item-template> <span md-highlight-text="ctrl.searchText">{{item.iata}}: {{item.name}}</span> </md-item-template> </md-autocomplete> </div> <div ng-show="ctrl.selectedItem" flex layout="row" layout-xs="column" layout-align="start start" layout-align-xs="start stretch" layout-wrap> <div layout="column" flex> <md-card class="info-card" flex> <md-list> <md-list-item> <md-icon md-svg-icon="map:place"></md-icon> <p>{{ctrl.selectedItem.name}}</p> </md-list-item> <md-list-item> <md-icon md-svg-icon="action:flight_land"></md-icon> <p>{{ctrl.totalLand}} planes are landed</p> </md-list-item> <md-list-item> <md-icon md-svg-icon="action:watch_later"></md-icon> <p>{{ctrl.totalDelayed}} planes are delayed</p> </md-list-item> </md-list> </md-card> <md-card ng-if="ctrl.map.center" flex> <md-card-title> <md-card-title-text> <span class="md-headline">Flights to {{ctrl.selectedItem.iata}}</span> </md-card-title-text> </md-card-title> <ui-gmap-google-map center="ctrl.map.center" zoom="ctrl.map.zoom" options="ctrl.map.options"> <ui-gmap-marker idkey="ctrl.map.destination.options.label" coords="ctrl.map.destination.coords" options="ctrl.map.destination.options"> </ui-gmap-marker> <ui-gmap-markers models="ctrl.map.origins" coords="\'coords\'" icon="\'icon\'" options="\'options\'" click="ctrl.onClick"> <ui-gmap-windows show="show"> <div ng-non-bindable>Distance: {{distance}} km</div> </ui-gmap-windows> </ui-gmap-markers> <ui-gmap-polyline ng-repeat="polyline in ctrl.map.polylines" path="polyline.path" stroke="polyline.stroke"> </ui-gmap-polyline> </ui-gmap-google-map> </md-card> </div> <div layout="column" flex> <md-card flex> <md-card-title> <md-card-title-text> <span class="md-headline">Flight frequency vs time of day</span> </md-card-title-text> </md-card-title> <div google-chart chart="ctrl.chart" style="width: 100%; height: 400px"></div> </md-card> </div> </div>')}]);